This version is a modified version of the original code
